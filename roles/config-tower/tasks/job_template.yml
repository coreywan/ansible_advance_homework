- name: Setup Credentials
  tower_credential:
    tower_host: "tower1.{{ tower_GUID }}.example.opentlc.com"
    tower_username: "{{ user_name }}"
    tower_password: "{{ password }}"
    name: "{{ cred.name }}"
    organization: "{{ cred.organization }}"
    kind: "{{ cred.kind }}"
    vault_password: "{{ cred.vault_password | default(omit) }}"
  loop_control:
    label: "{{ cred.name }}"
    loop_var: cred
  loop: "{{ tower_credentials }}"

- name: Setup Job Templates
  tower_job_template:
    tower_host: "tower1.{{ tower_GUID }}.example.opentlc.com"
    tower_username: "{{ user_name }}"
    tower_password: "{{ password }}"
    name: "{{ jt.name }}"
    project: "{{ jt.project }}"
    playbook: "{{ jt.playbook }}"
    credential: "{{ jt.credential | default(omit) }}"
    job_type: "{{ jt.job_type | default(omit) }}"
    vault_credential: "{{ jt.vault_credential | default(omit) }}"
    extra_vars_path: "{{ jt.extra_vars_path | default(omit) }}"
  loop_control:
    label: "{{ jt.name }}"
    loop_var: jt
  loop: "{{ tower_job_templates }}"

- name: Associate IG to OSP instances job template 
  command: |
    tower-cli job_template associate_ig --job-template "{{ job_template_name_osp_instances }}" --instance-group "{{instance_group_name}}"

- name: Associate IG to 3tier job template  
  command: |
    tower-cli job_template associate_ig --job-template "{{job_template_name_3tier_app}}" --instance-group "{{instance_group_name}}"

- name: Associate IG to OSP Delete instances job template 
  command: |
    tower-cli job_template associate_ig --job-template "{{job_template_name_osp_instances_delete}}" --instance-group "{{instance_group_name}}"

- name: Associate IG to Smoke test job template 
  command: |
    tower-cli job_template associate_ig --job-template "{{job_template_smoke_osp}}" --instance-group "{{instance_group_name}}"
